{% extends 'base.html' %}
{% block content %}
<h1>AI Code Agent: Issue Submission</h1>
<form method="POST" action="/">
    <label for="issue_text">Describe the issue or feature request:</label><br>
    <textarea name="issue_text" id="issue_text" rows="10"></textarea><br>
    <input type="submit" value="Generate Plan">
</form>
<form method="POST" action="/apply_plan" style="margin-top:10px;">
    <input type="hidden" name="issue_text" id="issue_text_hidden">
    <input type="hidden" name="plan_json" id="plan_json_hidden">
    <input type="submit" value="Approve Plan & Run">
    <button type="button" onclick="window.location.reload()">Reject Plan</button>
</form>
{% if error_message %}
<div class="results-section" style="color: red; border: 1px solid red; padding: 10px; background-color: #611;">
    <h2>Error:</h2>
    <pre>{{ error_message }}</pre>
</div>
{% endif %}
{% if submitted_issue %}
<div class="results-section">
    <h2>Submitted Issue:</h2>
    <pre>{{ submitted_issue }}</pre>
</div>
{% endif %}
{% if spec_data %}
<div class="results-section">
    <h2>Generated Specification (Spec):</h2>
    <pre>{{ spec_data }}</pre>
</div>
{% endif %}
{% if plan_data %}
<div class="results-section">
    <h2>Generated Plan (Phases):</h2>
    <textarea id="plan_editor" rows="10" style="width:98%;">{{ plan_data }}</textarea>
</div>
{% endif %}
<script>
const issueField = document.getElementById('issue_text');
const hiddenField = document.getElementById('issue_text_hidden');
const planHidden = document.getElementById('plan_json_hidden');
const applyForm = document.forms[1];
applyForm.addEventListener('submit', () => {
    hiddenField.value = issueField.value;
    const planEditor = document.getElementById('plan_editor');
    if (planEditor) planHidden.value = planEditor.value;
});
</script>
{% endblock %}
